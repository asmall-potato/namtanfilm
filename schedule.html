<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="CSS/styles.css">
    <link rel="stylesheet" href="CSS/calendar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400&display=swap" rel="stylesheet">
    <title>NamtanFilm Schedule Calendar</title>
</head>
<body>
    <header class="header-wallpaper-sub">
        <div class="header-container">
            <h1 class="logo">
                <span class="blue">NAMTAN</span><span class="yellow">FILM</span>
            </h1>
            <button class="nav-toggle" aria-label="toggle navigation">
            â˜°
            </button>
             <div id="navigation"></div>
        </div>
        
        
    </header>
    <main>
<div class="calendar-container">
    <!-- Left side: Calendar -->
    <div class="calendar-left">
        <div class="calendar-header">
            <button id="prev-month">Previous</button>
            <h2 id="calendar-title"></h2>
            <button id="next-month">Next</button>
        </div>

        <table class="calendar" id="calendar">
            <thead>
                <tr>
                    <th>Sun</th>
                    <th>Mon</th>
                    <th>Tue</th>
                    <th>Wed</th>
                    <th>Thu</th>
                    <th>Fri</th>
                    <th>Sat</th>
                </tr>
            </thead>
            <tbody id="calendar-body"></tbody>
        </table>
    </div>

    <!-- Right side: Full Schedule List -->
    <div class="calendar-right">
        <div class="schedule-list">
            <h3>NamtanFilm's Schedule for <span id="schedule-month"></span></h3>           
                <p><span class="legend-color blue_1"></span> represents Namtan Tipnaree</p>
                <p><span class="legend-color yellow_1"></span> represents Film Rachanun</p>
            <ul id="schedule-items"></ul>
        </div>
    </div>
</div>
</main>
<div id="footer-container"></div>
    
<script>
 // footer
            fetch('footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            })
            .catch(error => console.error('Error loading footer:', error));
    
 // Scroll reveal effect
 const sections = document.querySelectorAll('section');
    const options = {
        root: null,
        threshold: 0.1,
    };

    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate__animated', 'animate__fadeInUp');
                observer.unobserve(entry.target);
            }
        });
    }, options);

    sections.forEach(section => {
        observer.observe(section);
    });

// =======================
// Global schedule data
// =======================
let schedules = {};

// =======================
// Global variables
// =======================
let currentYear, currentMonth, selectedDate;
let malaysiaDate;

// =======================
// Load schedule JSON by year
// =======================
async function loadScheduleData() {
    try {
        const response = await fetch(`data/schedule-${currentYear}.json`); //load schedule json file by year, name format: schedule-20xx
        if (!response.ok) throw new Error("Schedule file not found");

        schedules = await response.json();
    } catch (error) {
        console.warn(`No schedule for year ${currentYear}`);
        schedules = {};
    }

    initializeCalendar();
}

// =======================
// Initialize calendar (render only)
// =======================
function initializeCalendar() {
    generateCalendar();
    updateScheduleList();
}

// =======================
// App startup (correct order)
// =======================
(function init() {
    const today = new Date().toLocaleString("en-US", {
        timeZone: "Asia/Kuala_Lumpur"
    });
    malaysiaDate = new Date(today);

    currentMonth = malaysiaDate.getMonth();
    currentYear = malaysiaDate.getFullYear();
    selectedDate = `${currentYear}-${String(currentMonth + 1).padStart(2, "0")}-${String(malaysiaDate.getDate()).padStart(2, "0")}`;

    loadScheduleData();
})();

// =======================
// Generate calendar (CSS SAFE)
// =======================
function generateCalendar() {
    const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
    const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0);
    const lastDateOfMonth = lastDayOfMonth.getDate();
    const firstWeekday = firstDayOfMonth.getDay();

    document.getElementById("calendar-title").textContent =
        `${firstDayOfMonth.toLocaleString("default", { month: "long" })} ${currentYear}`;
    document.getElementById("schedule-month").textContent =
        `${firstDayOfMonth.toLocaleString("default", { month: "long" })} ${currentYear}`;

    let calendarBody = "";
    let dayCounter = 1;

    for (let i = 0; i < 6; i++) {
        calendarBody += "<tr>";
        for (let j = 0; j < 7; j++) {
            if (i === 0 && j < firstWeekday) {
                calendarBody += "<td></td>";
            } else if (dayCounter <= lastDateOfMonth) {
                const dayString = `${currentYear}-${String(currentMonth + 1).padStart(2, "0")}-${String(dayCounter).padStart(2, "0")}`;

                const isToday =
                    dayCounter === malaysiaDate.getDate() &&
                    currentMonth === malaysiaDate.getMonth() &&
                    currentYear === malaysiaDate.getFullYear();

                const hasSchedule = schedules[dayString] !== undefined;
                const eventStatus = hasSchedule ? schedules[dayString][0].status : null;

                // ðŸ”‘ CSS-CRITICAL CLASSES
                let cellClass = "";
                if (isToday) cellClass += " today";
                if (hasSchedule) cellClass += " has-schedule";
                if (eventStatus === "postponed") cellClass += " postponed-event";
                if (eventStatus === "cancelled") cellClass += " cancelled-event";
                if (eventStatus === "passed") cellClass += " passed-event";

                const eventList = hasSchedule ? schedules[dayString] : [];
                let eventDetails = "";

                eventList.forEach(event => {
                    let eventColor = "black";
                    if (event.artist === "Namtan Tipnaree") eventColor = "blue";
                    if (event.artist === "Film Rachanun") eventColor = "#e0b300";

                    eventDetails += `
                        <div class="schedule-event" style="color:${eventColor}">
                            <strong>${event.description}</strong>
                        </div>`;
                });

                calendarBody += `
                    <td class="${cellClass}" onclick="showScheduleDetails('${dayString}')">
                        <strong>${dayCounter}</strong>
                        <div class="schedule-details">
                            ${eventDetails}
                        </div>
                    </td>`;
                dayCounter++;
            } else {
                calendarBody += "<td></td>";
            }
        }
        calendarBody += "</tr>";
        if (dayCounter > lastDateOfMonth) break;
    }

    document.getElementById("calendar-body").innerHTML = calendarBody;
}

// =======================
// Update schedule list (RIGHT PANEL)
// =======================
function updateScheduleList() {
    const scheduleItems = document.getElementById("schedule-items");
    scheduleItems.innerHTML = "";

    // If a date is selected â†’ show only that date
    if (selectedDate && schedules[selectedDate]) {
        renderDateWithEvents(selectedDate, schedules[selectedDate]);
        return;
    }

    // Otherwise â†’ show all events for current month
    const monthKey = `${currentYear}-${String(currentMonth + 1).padStart(2, "0")}`;

    Object.keys(schedules)
        .filter(date => date.startsWith(monthKey))
        .sort()
        .forEach(date => {
            renderDateWithEvents(date, schedules[date]);
        });
}


function renderDateWithEvents(date, events) {
    const scheduleItems = document.getElementById("schedule-items");

    const li = document.createElement("li");

    // Date + all events in ONE block
    let html = `<strong>${date}</strong><br><br>`;

    events.forEach((event, index) => {
        html += `
            <div class="schedule-details">
                <strong>${event.description}</strong><br>
                Time: ${event.time || "-"}<br>
                ${event.location ? `Location: ${event.location}<br>` : ""}
                ${event.live ? `Live: ${event.live}<br>` : ""}
                ${event.artist ? `Artist: ${event.artist}<br>` : ""}
                ${event.status === "postponed" ? `<div class="postponed-stamp">Postponed</div>` : ""}
                ${event.status === "cancelled" ? `<div class="cancelled-stamp">Cancelled</div>` : ""}
            </div>
        `;

        if (event.url) {
            html += `<a href="${event.url}" target="_blank">View Details</a>`;
        }

        if (index < events.length - 1) {
            html += `<hr>`;
        }
    });

    li.innerHTML = html;
    scheduleItems.appendChild(li);
}



// =======================
// Click date
// =======================
function showScheduleDetails(date) {
    selectedDate = date;
    updateScheduleList();
}

// =======================
// Month navigation (reload year)
// =======================
document.getElementById("next-month").addEventListener("click", () => {
    const oldYear = currentYear;

    if (currentMonth === 11) {
        currentMonth = 0;
        currentYear++;
    } else {
        currentMonth++;
    }

    selectedDate = null;
    currentYear !== oldYear ? loadScheduleData() : initializeCalendar();
});

document.getElementById("prev-month").addEventListener("click", () => {
    const oldYear = currentYear;

    if (currentMonth === 0) {
        currentMonth = 11;
        currentYear--;
    } else {
        currentMonth--;
    }

    selectedDate = null;
    currentYear !== oldYear ? loadScheduleData() : initializeCalendar();
});



// Change header transparency on scroll
const header = document.querySelector('.header-container');
        window.addEventListener('scroll', function() {
        const scrollPosition = window.scrollY;
        header.style.backgroundColor = scrollPosition > 50 ? 'rgba(255, 255, 255, 0.9)' : 'rgba(255, 255, 255, 0)';
        });

// Fetch navigation list from navigation.html
        document.addEventListener("DOMContentLoaded", function () {
            fetch('https://asmall-potato.github.io/namtanfilm/navigation.html')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('navigation').innerHTML = data;

                    // Now attach the event listener after navigation is loaded
                    const navToggle = document.querySelector(".nav-toggle");
                    const navMenu = document.querySelector("#navigation ul");

                    navToggle.addEventListener("click", function () {
                        navMenu.classList.toggle("showing");
                    });
                })
                .catch(error => console.error('Error loading navigation:', error));
        });
/*
    //Hamburger
         document.addEventListener("DOMContentLoaded", function () {
            const navToggle = document.querySelector(".nav-toggle");
            const navUl = document.querySelector("nav ul");

            navToggle.addEventListener("click", function () {
                navUl.classList.toggle("showing"); // Toggle the 'showing' class to show/hide the menu
            });
        });
        */
</script>

</body>
</html>
